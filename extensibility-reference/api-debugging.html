<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>调试器API | VS code Extension</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="">
    <link rel="preload" href="/vscode-extensions-docs/assets/css/0.styles.73fa3eb0.css" as="style"><link rel="preload" href="/vscode-extensions-docs/assets/js/app.e14d60cc.js" as="script"><link rel="preload" href="/vscode-extensions-docs/assets/js/2.b8c70ca2.js" as="script"><link rel="preload" href="/vscode-extensions-docs/assets/js/13.db33fb6f.js" as="script"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/10.dca9cd11.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/11.447bcbcb.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/12.6def7c20.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/14.43769345.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/15.54c52ed6.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/16.df112594.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/17.e32a424f.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/18.78847ffb.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/19.764d2659.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/20.bef6e61f.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/21.285144e4.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/22.ee4c432d.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/23.8a482eb7.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/24.55490fd3.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/25.767df54f.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/26.91187120.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/27.195aaba1.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/28.fa56d8f5.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/29.7e320131.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/3.11c3e3ef.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/30.e5ccfebb.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/31.9a803792.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/32.6bfb6d65.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/33.1ae3bafc.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/34.dd9ed8cb.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/35.d0b9e7e1.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/36.7ea76d5c.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/37.a357a6de.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/38.168ce191.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/39.c285d97a.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/4.5ed19beb.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/40.8f294c72.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/41.320937a4.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/42.82d92d14.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/43.e008b725.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/44.46fb0f39.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/45.b220f298.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/46.7fb4f3a5.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/47.12faff48.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/48.51253dc7.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/49.eb5bc903.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/5.f18d38ce.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/50.4471fd48.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/51.6299ecda.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/52.b747aebb.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/53.a0ceeb00.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/54.e43058f3.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/55.b6d982e8.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/56.46bb55c0.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/57.a25c1b5d.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/58.1e2be512.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/59.e52886fe.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/6.2e2d176c.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/60.7094fe90.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/61.bb194b74.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/62.cd3d6edb.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/63.3d00b856.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/64.a3a5f6ed.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/65.5cd44f99.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/66.e6e6bd22.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/67.000dcd44.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/68.52fd4d06.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/69.367e27ca.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/7.a91688a9.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/70.990506e9.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/71.7d6e3929.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/72.dab00503.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/73.ab260c98.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/74.e49e60c9.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/75.cc611012.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/76.3ce830b9.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/77.aa664ab8.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/78.1848ca8c.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/79.8cbdcbf4.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/8.e683c110.js"><link rel="prefetch" href="/vscode-extensions-docs/assets/js/9.11f4af0f.js">
    <link rel="stylesheet" href="/vscode-extensions-docs/assets/css/0.styles.73fa3eb0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vscode-extensions-docs/" class="home-link router-link-active"><img src="/vscode-extensions-docs/assets/img/logo.png" alt="VS code Extension" class="logo"> <span class="site-name can-hide">VS code Extension</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vscode-extensions-docs/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/vscode-extensions-docs/preknowledge/" class="nav-link">
  预备知识
</a></div><div class="nav-item"><a href="https://google.com" target="_self" class="nav-link external">
  External
  <!----></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vscode-extensions-docs/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/vscode-extensions-docs/preknowledge/" class="nav-link">
  预备知识
</a></div><div class="nav-item"><a href="https://google.com" target="_self" class="nav-link external">
  External
  <!----></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>术语表和说明</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vscode-extensions-docs/" aria-current="page" class="sidebar-link">Home</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/vscode-extensions-docs/preknowledge/" class="sidebar-heading clickable"><span>预备知识</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>概述</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发插件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>插件功能</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><a href="/vscode-extensions-docs/extension-guides/" class="sidebar-heading clickable"><span>插件指南</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/vscode-extensions-docs/extension-guides/" class="sidebar-link">插件指南</a></li><li><a href="/vscode-extensions-docs/extension-guides/command.html" class="sidebar-link">命令</a></li><li><a href="/vscode-extensions-docs/extension-guides/color-theme.html" class="sidebar-link">色彩主题</a></li><li><a href="/vscode-extensions-docs/extension-guides/icon-theme.html" class="sidebar-link">图标主题</a></li><li><a href="/vscode-extensions-docs/extension-guides/tree-view.html" class="sidebar-link">树视图</a></li><li><a href="/vscode-extensions-docs/extension-guides/webview.html" class="sidebar-link">Webview API</a></li><li><a href="/vscode-extensions-docs/extension-guides/virtual-documents.html" class="sidebar-link">虚拟文档</a></li><li><a href="/vscode-extensions-docs/extension-guides/task-provider.html" class="sidebar-link">任务</a></li><li><a href="/vscode-extensions-docs/extension-guides/scm-provider.html" class="sidebar-link">源控制API</a></li><li><a href="/vscode-extensions-docs/extension-guides/debugger-extension.html" class="sidebar-link">调试器插件</a></li><li><a href="/vscode-extensions-docs/extension-guides/markdown-extension.html" class="sidebar-link">Markdown插件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/vscode-extensions-docs/language-extensions/" class="sidebar-heading clickable"><span>语言插件</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/vscode-extensions-docs/language-extensions/" class="sidebar-link">概述</a></li><li><a href="/vscode-extensions-docs/language-extensions/syntax-highlight-guide.html" class="sidebar-link">语法高亮</a></li><li><a href="/vscode-extensions-docs/language-extensions/snippet-guide.html" class="sidebar-link">代码片段</a></li><li><a href="/vscode-extensions-docs/language-extensions/language-configuration-guide.html" class="sidebar-link">语言配置</a></li><li><a href="/vscode-extensions-docs/language-extensions/programmatic-language-features.html" class="sidebar-link">程序性语言特性</a></li><li><a href="/vscode-extensions-docs/language-extensions/language-server-extension-guide.html" class="sidebar-link">示例：语言服务器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/vscode-extensions-docs/preknowledge/" class="sidebar-heading clickable"><span>进阶主题</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/vscode-extensions-docs/advanced-topics/extension-host.html" class="sidebar-link">插件主机</a></li><li><a href="/vscode-extensions-docs/advanced-topics/remote-extensions.html" class="sidebar-link">支持远程开发</a></li><li><a href="/vscode-extensions-docs/advanced-topics/using-proposed-api.html" class="sidebar-link">使用不稳定的API</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/vscode-extensions-docs/preknowledge/" class="sidebar-heading clickable"><span>参考</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/vscode-extensions-docs/references/vscode-api.html" class="sidebar-link">VS Code API</a></li><li><a href="/vscode-extensions-docs/references/contribution-points.html" class="sidebar-link">发布内容配置</a></li><li><a href="/vscode-extensions-docs/references/activation-events.html" class="sidebar-link">激活事件</a></li><li><a href="/vscode-extensions-docs/references/extension-manifest.html" class="sidebar-link">插件清单</a></li><li><a href="/vscode-extensions-docs/references/commands.html" class="sidebar-link">内置命令</a></li><li><a href="/vscode-extensions-docs/references/theme-color.html" class="sidebar-link">主题色彩</a></li><li><a href="/vscode-extensions-docs/references/icons-in-labels.html" class="sidebar-link">标签中的图标</a></li><li><a href="/vscode-extensions-docs/references/document-selector.html" class="sidebar-link">文档选择器</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="调试器api"><a href="#调试器api" class="header-anchor">#</a> 调试器API</h1> <p>VS Code 允许插件创作者制作新的<strong>调试器插件</strong>，或为已有的调试功能添加<strong>特性</strong>。</p> <p>我们提供了两个领域的API：</p> <ul><li>通过成熟又强力的<strong>协议</strong>生成新的VS Code常规调试界面</li> <li>常规的<strong>插件API</strong>，但不包括VS Code的全部调试功能</li></ul> <p>提供这两种截然不同的API是因为VS Code的“热拔插调试器”插件架构（我们不会移除向后兼容的基于<em>协议</em>的调试器连接方法）</p> <p>下列图片展示了两种API在VS Code中协作的方式：</p> <p><img src="https://raw.githubusercontent.com/Microsoft/vscode-docs/master/docs/extensionAPI/images/api-debugging/debug-extension-api.png" alt="debug-extension-api"></p> <p><strong>调试适配器</strong>是一个典型的脱机程序，通过**调试适配器协议（Debug Adapter Protocol）**连接到真实的调试器和具体的调试器API上。因为调试适配器可以用任意的语言实现，因此非常适合先前<em>已有</em>的调试器或者运行时存在的场合，连接协议比实现了协议本身的客户端库提供的API更加重要。</p> <p>调试适配器并不是VS Code本身的插件，而要创作者封装出一个调试器插件才行，不要担心，你并不需要写太多代码。这个插件只是一个容器，在<code>package.json</code>中只要提供必要的<strong>配置项</strong>即可。当调试器会话运行后，VS Code会进入调试器插件，启动调试适配器，然后用调试适配器协议通信。</p> <p>下面是我们为调试器插件提供的最新的API。</p> <h2 id="调试器插件api"><a href="#调试器插件api" class="header-anchor">#</a> 调试器插件API</h2> <hr> <p>所有供调试使用的插件API都在<code>vscode.debug</code>下的命名空间中，你可以在<a href="https://github.com/Microsoft/vscode-docs/blob/master/docs/extensionAPI/vscode-api.md#debug" target="_blank" rel="noopener noreferrer">vscode 命名空间API参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中查看。</p> <h4 id="调试型钩子"><a href="#调试型钩子" class="header-anchor">#</a> 调试型钩子</h4> <p>所有调试型的钩子都在<code>DebugConfigurationProvider</code>中。</p> <p><code>registerDebugConfigurationProvider</code>注册了<code>DebugConfigurationProvider</code>，调试器类型本身是在<a href="https://github.com/Microsoft/vscode-docs/blob/master/docs/extensionAPI/extension-points.md#contributesdebuggers" target="_blank" rel="noopener noreferrer">发布内容配置项<code>debugger</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中配置的。</p> <p>当前，你可以使用的钩子有：</p> <ul><li><p>只要VS Code通过<code>launch.json</code>初始化出一个新的调试器配置就会为所有注册了<code>DebugConfigurationProviders</code>的插件调用<code>provideDebugConfigurations</code>，然后合并返回的调试器配置，注入到package.json中。</p></li> <li><p>VS Code每次在启动调试会话前调用<code>resolveDebugConfiguration</code>方法，<code>resolveDebugConfiguration</code>的实现可以通过给调试配置中传入缺省值或者添加/改变/移除配置项的方式和调试配置“通信”。通过这个机制，甚至可以实时调整调试类型。</p></li> <li><p><code>debugAdapterExecutable</code>方法会在VS Code启动了调试器之后调用，这个方法会返回调试适配器执行的路径（接受可选参数）。如果没有实现这个方法，VS Code则会使用package.json中配置的静态路径。</p></li></ul> <h4 id="调试会话生命周期api"><a href="#调试会话生命周期api" class="header-anchor">#</a> 调试会话生命周期API</h4> <p>一个调试会话在插件API中表示为<code>DebugSession</code>，它的声明周期可以通过下列方式控制和追踪：</p> <ul><li><code>startDebugging</code>：调试启动时触发，可以接受一个命名的调试器/复合配置/内存中的配置。</li> <li><code>onDidStartDebugSession</code>：调试会话启动后触发。</li> <li>当前激活的调试会话可由变量<code>activeDebugSession</code>获得，调试会话变动反应在<code>onDidChangeActiveDebugSession</code>事件中。</li> <li><code>onDidTerminateDebugSession</code>：调试会话关闭后触发。</li></ul> <h4 id="调试会话api"><a href="#调试会话api" class="header-anchor">#</a> 调试会话API</h4> <p>目前调试会话的API还比较少：</p> <ul><li>通过<code>customRequest</code>方法将调试适配器的请求发送到受控调试方。</li> <li>自定义的调试适配器事件在<code>onDidReceiveDebugSessionCustomEvent</code>中获取。</li></ul> <h4 id="断点api"><a href="#断点api" class="header-anchor">#</a> 断点API</h4> <p>所有的断点类型都是<code>Breakpoint</code>的子类，当前提供的子类有<code>SourceBreakpoint</code>和<code>FunctionBreakpoint</code></p> <ul><li><code>vscode.debug.breakpoints</code>提供了工作区所有的断点集合。用<code>instanceof</code>检查单个断点的具体对象类型。</li> <li><code>vscode.debug.onDidChangeBreakpoints</code>侦听断点的添加、移除、改变事件。</li> <li><code>SourceBreakpoints</code>和<code>FunctionBreakpoints</code>只能通过<code>addBreakpoints</code>和<code>removeBreakpoints</code>函数添加。</li></ul> <p>!&gt;注意：一开始获取断点可能是一个空数组，而随后则会触发<code>BreakpointsChangeEvent</code>事件并更新<code>vscode.debug.breakpoints</code>，在这个时间点你就能获得正确的集合。所以如果你需要正确的断点集合，不要忘了注册<code>BreakpointsChangeEvent</code>事件。</p> <h2 id="调试适配器协议-dap-debug-adapter-protocol"><a href="#调试适配器协议-dap-debug-adapter-protocol" class="header-anchor">#</a> 调试适配器协议（DAP - Debug Adapter Protocol）</h2> <hr> <p>你可以在<a href="https://github.com/Microsoft/vscode-debugadapter-node" target="_blank" rel="noopener noreferrer">vscode-debugadapter-node<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>仓库中找到JSON格式或者TypeScript定义的<a href="https://microsoft.github.io/debug-adapter-protocol" target="_blank" rel="noopener noreferrer">调试适配器协议<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>规格说明书。这两个文件都详细地列出了每个协议的请求、响应和事件结构。这个协议在NPM库<a href="https://www.npmjs.com/package/vscode-debugprotocol" target="_blank" rel="noopener noreferrer">vscode-debugprotocol<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中也可以找到。</p> <p>我们已经实现了调试适配器协议的TypeScript和C#客户端版本，不过只有JavaScript/TypeScript的客户端库在NPM<a href="https://github.com/Microsoft/vscode-debugadapter-node" target="_blank" rel="noopener noreferrer">vscode-debugadapter-node<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中是可用的。C#的库可以在<a href="https://github.com/Microsoft/vscode-mono-debug/blob/master/src/DebugSession.cs" target="_blank" rel="noopener noreferrer">Mono Debug<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中找到。</p> <p>下列调试器插件项目会教你如何实现调试适配器：</p> <table><thead><tr><th>GitHub项目</th> <th>描述</th> <th>实现语言</th></tr></thead> <tbody><tr><td><a href="https://github.com/Microsoft/vscode-mock-debug.git" target="_blank" rel="noopener noreferrer">Mock Debug<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td>一个假的调试器</td> <td>TypeScript</td></tr> <tr><td><a href="https://github.com/Microsoft/vscode-node-debug2.git" target="_blank" rel="noopener noreferrer">Node Debug2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td>内建的基于CDP-based的Node.js调试器</td> <td>TypeScript</td></tr> <tr><td><a href="https://github.com/Microsoft/vscode-node-debug.git" target="_blank" rel="noopener noreferrer">Node Debug<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td>内建的传统Node.js调试器</td> <td>TypeScript</td></tr> <tr><td><a href="https://github.com/Microsoft/vscode-mono-debug.git" target="_blank" rel="noopener noreferrer">Mono Debug<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td>一个供Mono使用的简单的C#调试器</td> <td>C#</td></tr></tbody></table> <h2 id="一语道破-调试适配器协议"><a href="#一语道破-调试适配器协议" class="header-anchor">#</a> 一语道破——调试适配器协议</h2> <hr> <p>我们快速地看一下VS Code和调试器间的互动，这应该能帮你快速地实现基于调试适配器协议的调试适配器。</p> <p>调试器会话启动，VS Code加载调试适配器，通过<em>stdin</em>和<em>stdout</em>进行通信。VS Code发送了一个<strong>初始化</strong>请求，然后用<em>行列值是0，1</em>的路径格式信息（原生或URI）配置好调试器。如果你的调试器是TypeScript或C#实现的<code>Debugsession</code>中派生出来的，你则不需要自行处理初始化请求。</p> <p>根据用户创建的启动配置文件中的<em>请求</em>属性，VS Code会发送*加载（launch）<em>或是</em>附加（attch）*请求。对于<strong>加载</strong>类型，调试适配器需要加载一个运行时或者可以调试的程序。如果这个程序可以通过stdin/stdout和用户进行交互，那么调试适配器就会在一个可交互的终端或者控制台加载这个程序。对于<strong>附加</strong>类型，调试适配器则会连接或者附加到一个已经运行的程序上面。</p> <p>因为这两种请求的参数都高度依赖特定的调试适配器实现，所以调试适配器协议不提供任何参数描述。而VS Code则会把所有用户启动配置传给<em>加载</em>或<em>附加</em>请求。这两种属性的智能补全和悬停信息提示可以在适配器插件中的<code>package.json</code>进行配置，以帮助用户知道何时可以创建或编辑<em>启动配置</em>。</p> <p>VS Code会帮调试适配器保留断点，所以必须要在调试会话启动时，对应地注册适配器中的断点。因为VS Code不知道注册断点的最佳时机，所以调试适配器会发送一个<strong>initialize</strong>事件给VS Code，告知它已经准备好接收断点配置请求了。</p> <p>然后VS Code就会调用断点配置请求，发送所有的断点：</p> <ul><li><strong>setBreakpoints</strong> 为每个源文件带上断点，</li> <li><strong>setFunctionBreakpoints</strong> 如果调试适配器支持函数断点，</li> <li><strong>setExceptionBreakpoints</strong> 如果调试适配器支持异常选项，</li> <li><strong>configurationDoneRequest</strong> 指示配置序列已经结束。</li></ul> <p>所以，当你准备好了的时候不要忘了发送<em>initialize</em>事件接收断点。不然已保留的断点不会再储存下来。</p> <p><em>setBreakpoints</em>请求为文件设置所有已存在的断点（所以不是增量的哦）。常见的场景就是为某个文件清除所有的断点，然后再根据请求设置断点。<em>setFunctionBreakpoints</em>和<em>setFunctionBreakpoints</em>需要返回真正的断点，然后VS Code就会动态地更新UI，如果断点无法跟随请求设置然后就会在后台移除。</p> <p>当程序停止（在程序入口，断点命中，抛出异常，或者用户需要暂停执行），那么调试适配器必须发出<strong>stopped</strong>事件，带上原因和线程id。根据这条信息，VS Code会先请求<strong>threads</strong>（见下），然后列出停止的线程的堆栈追踪日志（栈帧列表）。如果用户深入到栈帧（stack frame）中去，VS Code会先请求这个栈帧的<strong>scopes</strong>，然后是这个scope的变量。如果变量是自构建的，VS Code会通过额外的<em>variables</em>请求获取它的属性。这个过程会生成下列事件层级：</p> <div class="language- extra-class"><pre class="language-text"><code>Threads
   Stackframes
      Scopes
         Variables
            ...
               Variables
</code></pre></div><p>VS Code调试界面支持多线程（如果你只用Node.js调试器的话可能还不知道这个功能）。当VS Code接收到<strong>stopped</strong>或<strong>thread</strong>事件，然后它会立刻请求当时所有的<strong>threads</strong>并显示到界面上。如果只检测到一个线程，VS Code则会保留在单线程模式。<strong>Thread</strong>事件是可选的，不过调试适配器可以强制发送这个事件，即使不在暂停状态，VS Code也会动态地更新线程界面。</p> <p>成功地<strong>加载</strong>或<strong>附加</strong>了调试适配器后，VS Code会发送<strong>threads</strong>请求当前线程，获取线程基线，然后开始侦听<strong>threads</strong>事件检查是否有新的或是终止的线程。即使你的调试适配器不支持多线程，它也必须实现<strong>threads</strong>请求，然后返回一个（虚假的）线程。线程的id必须要在所有需要线程id的地方消费掉，比如：<strong>stacktrace</strong>， <strong>pause</strong>，<strong>continue</strong>，<strong>next</strong>，<strong>stepIn</strong>，和 <strong>stepOut</strong>。</p> <p>当发送<strong>disconnect</strong>请求时，VS Code会终止调试会话。如果调试目标在<em>加载</em>时被断开了，那么则会终止目标程序（如果必要的话，会强制终止）。如果调试目标在<em>附加</em>初始化时断开，那么则会立刻断开目标（程序则会继续执行）。在目标正常终止或崩溃时，调试适配器必须触发一个<strong>terminated</strong>事件。收到断开请求后，VS Code就会关闭调试适配器。</p> <h2 id="下一步"><a href="#下一步" class="header-anchor">#</a> 下一步</h2> <p>学习更多VS Code扩展性模型，请参阅下列主题：</p> <ul><li><a href="/vscode-extensions-docs/extension-authoring/example-debug-adapter.html">示例：调试器</a> - 查看一个可执行的'模拟'调试器示例。</li> <li><a href="/vscode-extensions-docs/extensibility-reference/vscode-api.html">插件API概览</a> - 学习完整的VS Code扩展性模型。</li> <li><a href="/vscode-extensions-docs/extensibility-reference/extension-manifest.html">插件配置清单</a> - VS Code的package.json插件配置清单参阅</li> <li><a href="/vscode-extensions-docs/extensibility-reference/contribution-points.html">发布内容配置</a> - VS Code发布内容配置参阅</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/vscode-extensions-docs/assets/js/app.e14d60cc.js" defer></script><script src="/vscode-extensions-docs/assets/js/2.b8c70ca2.js" defer></script><script src="/vscode-extensions-docs/assets/js/13.db33fb6f.js" defer></script>
  </body>
</html>
