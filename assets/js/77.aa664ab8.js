(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{424:function(t,s,e){"use strict";e.r(s);var a=e(42),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"持续集成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#持续集成"}},[t._v("#")]),t._v(" 持续集成")]),t._v(" "),e("p",[t._v("插件测试也可以用诸如"),e("a",{attrs:{href:"https://travis-ci.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Travis CI"),e("OutboundLink")],1),t._v("自动运行测试。"),e("a",{attrs:{href:"https://github.com/Microsoft/vscode-test",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("vscode-test")]),e("OutboundLink")],1),t._v("库可以基于 CI 设置插件测试，而且里面还包含了一个 Azure Pipelines 的"),e("a",{attrs:{href:"https://github.com/microsoft/vscode-test/tree/master/sample",target:"_blank",rel:"noopener noreferrer"}},[t._v("示例插件"),e("OutboundLink")],1),t._v("。你可以先看看"),e("a",{attrs:{href:"https://dev.azure.com/vscode/vscode-test/_build?definitionId=15",target:"_blank",rel:"noopener noreferrer"}},[t._v("构建管线"),e("OutboundLink")],1),t._v("是什么样子的，或者直接查看"),e("a",{attrs:{href:"https://github.com/microsoft/vscode-test/blob/master/sample/azure-pipelines.yml",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("azure-pipelines.yml")]),t._v("file"),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("h2",{attrs:{id:"azure-pipelines"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#azure-pipelines"}},[t._v("#")]),t._v(" Azure Pipelines")]),t._v(" "),e("hr"),t._v(" "),e("p",[e("img",{attrs:{src:"https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/working-with-extensions/images/continuous-integration/pipelines-logo.png",alt:"pipelines-logo"}})]),t._v(" "),e("p",[t._v("你可以在"),e("a",{attrs:{href:"https://azure.microsoft.com/services/devops/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azure DevOps"),e("OutboundLink")],1),t._v("上创建免费的项目，它为你提供了代码托管、看板、构建和测试基础设施等等。最重要的是，你可以获得"),e("a",{attrs:{href:"https://azure.microsoft.com/services/devops/pipelines/",target:"_blank",rel:"noopener noreferrer"}},[t._v("10 个免费的并行任务"),e("OutboundLink")],1),t._v("容量，用于你构建项目，不论是在 Windows, macOS 还是 Linux 上。")]),t._v(" "),e("p",[t._v("首先，你需要创建一个免费的"),e("a",{attrs:{href:"https://azure.microsoft.com/services/devops/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azure DevOps"),e("OutboundLink")],1),t._v("账号，然后给你的插件创建一个"),e("a",{attrs:{href:"https://azure.microsoft.com/en-us/features/devops-projects/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azure DevOps 项目"),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("p",[t._v("然后，把"),e("code",[t._v("azure-pipelines.yml")]),t._v("文件添加到插件仓库的根目录下，不同于 Linux 中的"),e("code",[t._v("xvfb")]),t._v("配置脚本，需要 VS Code 运行在 Linux 的无头 CI 机器上，我们的配置文件非常简单：")]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("trigger")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("strategy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matrix")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("linux")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imageName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ubuntu-16.04"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mac")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imageName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"macos-10.13"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("windows")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imageName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vs2017-win2016"')]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pool")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("vmImage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $(imageName)\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("task")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NodeTool@0\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("inputs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("versionSpec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8.x"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("displayName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Install Node.js"')]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bash")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v('\n      /usr/bin/Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &\n      echo ">>> Started xvfb"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("displayName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Start xvfb\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("condition")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" and(succeeded()"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eq(variables"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Agent.OS'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'Linux'))\n\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bash")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v('\n      echo ">>> Compile vscode-test"\n      yarn && yarn compile\n      echo ">>> Compiled vscode-test"\n      cd sample\n      echo ">>> Run sample integration test"\n      yarn && yarn compile && yarn test')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("displayName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Run Tests\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DISPLAY")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('":99.0"')]),t._v("\n")])])]),e("p",[t._v("最后，在你的 DveOps 项目里"),e("a",{attrs:{href:"https://docs.microsoft.com/azure/devops/pipelines/get-started-yaml?view=vsts#get-your-first-build",target:"_blank",rel:"noopener noreferrer"}},[t._v("创建一个新的管线"),e("OutboundLink")],1),t._v("，然后指向"),e("code",[t._v("azure-pipelines.yml")]),t._v("文件，启动 build，然后……真香~")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/working-with-extensions/images/continuous-integration/pipelines.png",alt:"pipelines"}})]),t._v(" "),e("p",[t._v("你可以启用持续构建——每当有 pull requests 进入特定分支的时候自动进行构建。相关内容请查看"),e("a",{attrs:{href:"https://docs.microsoft.com/azure/devops/pipelines/build/triggers",target:"_blank",rel:"noopener noreferrer"}},[t._v("构建管线触发器"),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("h2",{attrs:{id:"travis-ci"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#travis-ci"}},[t._v("#")]),t._v(" Travis CI")]),t._v(" "),e("hr"),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/microsoft/vscode-test",target:"_blank",rel:"noopener noreferrer"}},[t._v("vscode-test"),e("OutboundLink")],1),t._v("还包含了一份"),e("a",{attrs:{href:"https://github.com/microsoft/vscode-test/blob/master/.travis.yml",target:"_blank",rel:"noopener noreferrer"}},[t._v("Travis CI 构建文件"),e("OutboundLink")],1),t._v("，因为 Travis 上的环境变量定义和 Azure 所有不同，"),e("code",[t._v("xvfb")]),t._v("脚本也有些许不一样：")]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("language")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node_js\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("os")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" osx\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" linux\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node_js")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("install")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n    if [ $TRAVIS_OS_NAME == \"linux\" ]; then\n      export DISPLAY=':99.0'\n      /usr/bin/Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &\n    fi")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v('\n    echo ">>> Compile vscode-test"\n    yarn && yarn compile\n    echo ">>> Compiled vscode-test"\n    cd sample\n    echo ">>> Run sample integration test"\n    yarn && yarn compile && yarn test')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yarn\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);