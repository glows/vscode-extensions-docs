(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{378:function(t,s,e){"use strict";e.r(s);var a=e(42),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"测试你的插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试你的插件"}},[t._v("#")]),t._v(" 测试你的插件")]),t._v(" "),e("p",[t._v("VS Code可以运行和调试支持VS Code API的插件。这些测试会运行在VS Code的特殊实例"),e("code",[t._v("扩展开发环境")]),t._v("中，这个环境有权访问全部的API。我们将这样的测试称为集成测试，因为它远远超越了单独运行在VS Code中的单元测试。本篇侧重于VS Code的集成测试，至于单元测试，你可以使用任何流行的测试框架，如"),e("a",{attrs:{href:"https://mochajs.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mocha"),e("OutboundLink")],1),t._v("或者"),e("a",{attrs:{href:"https://jasmine.github.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Jasmine"),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("h2",{attrs:{id:"yo-code测试脚手架"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#yo-code测试脚手架"}},[t._v("#")]),t._v(" Yo Code测试脚手架")]),t._v(" "),e("hr"),t._v(" "),e("p",[e("RouterLink",{attrs:{to:"/extension-authoring/extension-generator.html"}},[t._v("yo code 生成器")]),t._v("基础插件项目包含了一些示例测试和必要的基础设施。")],1),t._v(" "),e("p",[t._v("!> **注意：**本篇假设你已经创建了一个Typescript插件（或Javascript插件），不然先参考"),e("a",{attrs:{href:"extension-authoring/extension-generator"}},[t._v("基础部分")])]),t._v(" "),e("p",[t._v("打开一个插件项目目录，打开"),e("strong",[t._v("调试")]),t._v("侧边栏选择"),e("code",[t._v("Extension Tests")]),t._v("配置。")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://raw.githubusercontent.com/Microsoft/vscode-docs/master/docs/extensions/images/testing-extensions/launch-tests.png",alt:"launch-tests"}})]),t._v(" "),e("p",[t._v("选中配置之后，点击绿色的小角标，启动调试。VS Code会在"),e("code",[t._v("扩展开发环境")]),t._v("实例中加载插件，然后运行调试。测试的输出会进入"),e("em",[t._v("调试控制台")]),t._v("：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://raw.githubusercontent.com/Microsoft/vscode-docs/master/docs/extensions/images/testing-extensions/test-output.png",alt:"test-output"}})]),t._v(" "),e("p",[t._v("生成的测试使用了"),e("a",{attrs:{href:"https://mochajs.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mocha 测试框架"),e("OutboundLink")],1),t._v("的测试运行器和库。")]),t._v(" "),e("p",[t._v("插件项目文件夹中的附带了"),e("code",[t._v("src/test")]),t._v("，其中有一个"),e("code",[t._v("index.ts")]),t._v("文件，定义了Mocha测试运行器的配置，"),e("code",[t._v("extension.test.ts")]),t._v("中包含着测试示例"),e("code",[t._v("Something 1")]),t._v("。通常来说你可以不管"),e("code",[t._v("index.ts")]),t._v("，不过你也可以调整Mocha的配置。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("├── src\n│   └── test\n│       ├── extension.test.ts\n│       └── index.ts\n")])])]),e("p",[t._v("你可以在"),e("code",[t._v("test")]),t._v("目录下创建更多的"),e("code",[t._v("test.ts")]),t._v("文件，它们会被自动构建（到"),e("code",[t._v("out/test")]),t._v("）然后运行。测试运行器只会匹配"),e("code",[t._v("*.test.ts")]),t._v("模式的文件。")]),t._v(" "),e("h2",{attrs:{id:"加载测试配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#加载测试配置"}},[t._v("#")]),t._v(" 加载测试配置")]),t._v(" "),e("hr"),t._v(" "),e("p",[e("code",[t._v("Extension Tests")]),t._v("的配置文件在项目的"),e("code",[t._v(".vscode\\launch.json")]),t._v("的文件中。就像"),e("code",[t._v("Extension")]),t._v("配置一样，通过"),e("code",[t._v("--extensionTestsPath")]),t._v("参数，指定编译的测试文件位置（假设是Typescript项目）。")]),t._v(" "),e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Extension Tests"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"extensionHost"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"request"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"launch"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"runtimeExecutable"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${execPath}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"args"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--extensionDevelopmentPath=${workspaceFolder}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--extensionTestsPath=${workspaceFolder}/out/test"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"outFiles"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${workspaceFolder}/out/test/**/*.js"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h2",{attrs:{id:"将参数传递到扩展开发环境中"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#将参数传递到扩展开发环境中"}},[t._v("#")]),t._v(" 将参数传递到扩展开发环境中")]),t._v(" "),e("hr"),t._v(" "),e("p",[t._v("在加载配置中添加参数列表，然后测试示例就能在你指定的目录或文件中启动测试了。")]),t._v(" "),e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"args"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"file or folder name"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--extensionDevelopmentPath=${workspaceFolder}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--extensionTestsPath=${workspaceFolder}/out/test"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),e("p",[t._v("用这个方式，你的测试就可以运行在可预测的文件结构中运行了。")]),t._v(" "),e("h2",{attrs:{id:"从项目中排除测试文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#从项目中排除测试文件"}},[t._v("#")]),t._v(" 从项目中排除测试文件")]),t._v(" "),e("hr"),t._v(" "),e("p",[t._v("当你想要分享插件的时候，你可能就不需要测试文件出现在"),e("em",[t._v("插件包")]),t._v("里了。"),e("a",{attrs:{href:"https://github.com/Microsoft/vscode-docs/blob/master/docs/extensions/publish-extension.md#advance-usage",target:"_blank",rel:"noopener noreferrer"}},[t._v(".vscodeignore"),e("OutboundLink")],1),t._v("文件可以让你在使用"),e("a",{attrs:{href:"https://github.com/Microsoft/vscode-docs/blob/master/docs/extensions/publish-extension.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("vsce构建工具"),e("OutboundLink")],1),t._v("的时候排除测试文件。默认情况下，"),e("code",[t._v("yo code")]),t._v("生成的项目会排除"),e("code",[t._v("test")]),t._v("和"),e("code",[t._v("out/test")]),t._v("文件夹。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("out/test/**\n")])])]),e("h2",{attrs:{id:"使用travis-ci自动测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用travis-ci自动测试"}},[t._v("#")]),t._v(" 使用Travis CI自动测试")]),t._v(" "),e("hr"),t._v(" "),e("p",[t._v("你也可以用诸如"),e("a",{attrs:{href:"https://travis-ci.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Travis CI"),e("OutboundLink")],1),t._v("自动构建机器来自动运行测试。")]),t._v(" "),e("p",[t._v("为了启动自动插件测试，"),e("code",[t._v("vscode")]),t._v("包需要提供一个可以运行下列任务的测试命令：")]),t._v(" "),e("ul",[e("li",[t._v("下载和解压VS Code")]),t._v(" "),e("li",[t._v("在VS Code内加载插件测试任务")]),t._v(" "),e("li",[t._v("将测试结果输出到控制台中，或在异常中退出")])]),t._v(" "),e("p",[t._v("为了完成这项命令，打开你的"),e("code",[t._v("package.json")]),t._v("然后将下列代码添加到"),e("code",[t._v("scripts")]),t._v("中：")]),t._v(" "),e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"test"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node ./node_modules/vscode/bin/test"')]),t._v("\n")])])]),e("p",[t._v("你可以在顶层配置一个"),e("code",[t._v(".travis.yml")]),t._v("文件，就可以轻松地启用Travis CI了：")]),t._v(" "),e("div",{staticClass:"language-yml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sudo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("os")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" osx\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" linux\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("before_install")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" if "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(' $TRAVIS_OS_NAME == "linux" '),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v('; then\n      export CXX="g++'),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('4.9" CC="gcc'),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('4.9" DISPLAY='),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("99.0;\n      sh "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("e /etc/init.d/xvfb start;\n      sleep 3;\n    fi\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("install")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm install\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm run vscode"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("prepublish\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm test "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("silent\n")])])]),e("p",[t._v("上述脚本可以运行在Linux和macOS上，值得注意的一点是为了在Linux上运行测试，你需要配置一个"),e("code",[t._v("before_install")]),t._v("告诉Linux在构建中启动VS Code。")]),t._v(" "),e("p",[t._v("下面是一些用于测试运行器的可选的环境变量：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("名称")]),t._v(" "),e("th",[t._v("描述")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("CODE_VERSION")]),t._v(" "),e("td",[t._v("运行测试的VS Code版本（如：0.10.10）")])]),t._v(" "),e("tr",[e("td",[t._v("CODE_DOWNLOAD_URL")]),t._v(" "),e("td",[t._v("下载VS Code的完整URL")])]),t._v(" "),e("tr",[e("td",[t._v("CODE_TESTS_PATH")]),t._v(" "),e("td",[t._v("执行测试的位置（默认是process.cwd()/out/test or process.cwd()/test）")])]),t._v(" "),e("tr",[e("td",[t._v("CODE_EXTENSIONS_PATH")]),t._v(" "),e("td",[t._v("加载插件的位置（默认是process.cwd()）")])]),t._v(" "),e("tr",[e("td",[t._v("CODE_TESTS_WORKSPACE")]),t._v(" "),e("td",[t._v("test实例打开的工作区位置（默认是CODE_TESTS_PATH）")])])])]),t._v(" "),e("h2",{attrs:{id:"在windows中使用appveyor测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在windows中使用appveyor测试"}},[t._v("#")]),t._v(" 在Windows中使用AppVeyor测试")]),t._v(" "),e("hr"),t._v(" "),e("p",[t._v("你也可以在Windows中用"),e("a",{attrs:{href:"https://www.appveyor.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("AppVeyor"),e("OutboundLink")],1),t._v("进行测试")]),t._v(" "),e("h2",{attrs:{id:"下一步"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#下一步"}},[t._v("#")]),t._v(" 下一步")]),t._v(" "),e("ul",[e("li",[e("RouterLink",{attrs:{to:"/extension-authoring/developing-extensions.html"}},[t._v("发开插件")]),t._v(" - 学习更多调试插件的内容。")],1),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/Microsoft/vscode-docs/blob/master/docs/extensions/publish-extension.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("vsce"),e("OutboundLink")],1),t._v(" - 使用VSCE命令行工具发布插件。")]),t._v(" "),e("li",[e("RouterLink",{attrs:{to:"/extensibility-reference/extension-manifest.html"}},[t._v("插件配置清单")]),t._v(" - VS Code插件配置清单参阅。")],1),t._v(" "),e("li",[e("RouterLink",{attrs:{to:"/extensibility-reference/vscode-api.html"}},[t._v("扩展API")]),t._v(" - 学习更多VS Code扩展性API。")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);